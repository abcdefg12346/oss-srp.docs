<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Umsetzung | OSS-SRP - Dokumentation</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../analyse.html" />
    
    
    <link rel="prev" href="../intro/introduction.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="0.2"
        data-chapter-title="Umsetzung"
        data-filepath="umsetzung/umsetzung.md"
        data-basepath=".."
        data-revision="Wed May 18 2016 10:51:24 GMT+0200 (CEST)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Part 1
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="0.1" data-path="intro/introduction.html">
            
                
                    <a href="../intro/introduction.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>0.1.</b>
                        
                        Einleitung
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="0.1.1" data-path="intro/introduction.html">
            
            <span><b>0.1.1.</b> Aufgabenstellung</span>
            
            
        </li>
    
        <li class="chapter " data-level="0.1.2" data-path="intro/introduction.html">
            
            <span><b>0.1.2.</b> Ziel</span>
            
            
        </li>
    
        <li class="chapter " data-level="0.1.3" data-path="intro/introduction.html">
            
            <span><b>0.1.3.</b> Anforderungen</span>
            
            
        </li>
    
        <li class="chapter " data-level="0.1.4" data-path="intro/introduction.html">
            
            <span><b>0.1.4.</b> Technische Projektumsetzung</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="0.1.4.1" data-path="intro/introduction.html">
            
            <span><b>0.1.4.1.</b> Backend</span>
            
            
        </li>
    
        <li class="chapter " data-level="0.1.4.2" data-path="intro/introduction.html">
            
            <span><b>0.1.4.2.</b> Frontend</span>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="0.2" data-path="umsetzung/umsetzung.html">
            
                
                    <a href="../umsetzung/umsetzung.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>0.2.</b>
                        
                        Umsetzung
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="0.2.1" data-path="umsetzung/umsetzung.html">
            
            <span><b>0.2.1.</b> Datenbank</span>
            
            
        </li>
    
        <li class="chapter " data-level="0.2.2" data-path="umsetzung/umsetzung.html">
            
            <span><b>0.2.2.</b> NodeJS</span>
            
            
        </li>
    
        <li class="chapter " data-level="0.2.3" data-path="umsetzung/umsetzung.html">
            
            <span><b>0.2.3.</b> Authentification</span>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="0.3" data-path="analyse.html">
            
                
                    <a href="../analyse.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>0.3.</b>
                        
                        Analyse
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="0.3.1" data-path="analyse.html">
            
            <span><b>0.3.1.</b> Soll-Kriterien</span>
            
            
        </li>
    
        <li class="chapter " data-level="0.3.2" data-path="analyse.html">
            
            <span><b>0.3.2.</b> Kann-Kriterien</span>
            
            
        </li>
    
        <li class="chapter " data-level="0.3.3" data-path="analyse.html">
            
            <span><b>0.3.3.</b> Wunsch-Kriterien</span>
            
            
        </li>
    
        <li class="chapter " data-level="0.3.4" data-path="analyse.html">
            
            <span><b>0.3.4.</b> Zeit</span>
            
            
        </li>
    
        <li class="chapter " data-level="0.3.5" data-path="analyse.html">
            
            <span><b>0.3.5.</b> Lessons learned</span>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="0.4" data-path="sources.html">
            
                
                    <a href="../sources.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>0.4.</b>
                        
                        Quellen
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >OSS-SRP - Dokumentation</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="umsetzung">Umsetzung</h1>
<h2 id="datenbank">Datenbank</h2>
<p>Die Datenbank ist ein PostgreSQL-System, in welches einmalig manuell die statischen Spiele-Daten importiert werden sollten. Diese Daten werden  alle 6 Wochen aktualisiert. Hier f&#xFC;r hat bietet ein anderes Community-Mitgleid einen PostgreSQL-Dump an, welcher vom System heruntergeladen werden und in die Datenbank importiert werden sollten.</p>
<p>In anbetracht der Skalierbarkeit der Anwendung und zuk&#xFC;nftigen Pl&#xE4;nen mit der Applikation, war ein solcher statischer Import der Daten nicht n&#xFC;tzlich.
Daher haben wir uns entschieden eine eigene &quot;Harvester&quot;-Funktion zu schreiben. Zum einen ben&#xF6;tigten wir aus dem PostgreSQL-Dump nur wenige Inhalte, und zum anderen h&#xE4;tten wir eine Art die Verlustdaten &quot;einzusammeln&quot; immer noch ben&#xF6;tigt.
Diese Verlustdaten und statischen Daten stehen gemeinsam in einer Datenbank, welche relationell miteinander verkn&#xFC;pft ist.</p>
<p><img src="erm.png" alt="erm"></p>
<h2 id="nodejs">NodeJS</h2>
<p>NodeJS ist immernoch relativ experimentell, vor allem verglichen mit den gro&#xDF;en, wie Python und PHP. Jedoch vom reinen Umfang her bietet sich NodeJS durchaus an. Es ist derzeit die gr&#xF6;&#xDF;te Webumgebung, von der reinen Paketanzahl und -angebot.</p>
<p>Es bietet sich zudem an, NodeJS zu nezten, da es nativ mit JSON arbeiten kann, und damit ideal f&#xFC;r den Umgang mit der CREST-API des Entwicklers von EVE Online.</p>
<p>Mit der oben beschriebenen <em>&quot;Harvester&quot;</em>-Methode sammeln wir nur die von uns ben&#xF6;tigten Daten aus den Verlustdaten und speichern Sie in die Datenbank.
Hiermit haben wir nur die gezielten Datens&#xE4;tze die wir f&#xFC;r eine weitere Verarbeitung ben&#xF6;tigen und vermeiden somit Datenm&#xFC;ll in der Datenbank.
Dies ist, in gek&#xFC;rzter Form, die <em>&quot;Harvester&quot;</em>-Methode.
Es wird eine &quot;Killmail&quot; geladen, die entsprechenden, gew&#xFC;nschten Daten geladen und daraufhin in die Datenbank importiert.</p>
<pre><code class="lang-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Harvester</span>(<span class="hljs-params">app</span>) </span>{
    <span class="hljs-keyword">this</span>.addMail = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">mail</span>) </span>{
        <span class="hljs-keyword">const</span> date = moment(mail.killTime, <span class="hljs-string">&quot;YYYY-MM-DD HH-mm-ss&quot;</span>);
        }
    [<span class="hljs-string">&apos;...&apos;</span>]
        mail.attackers.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">attacker</span>) </span>{
                self.cache.corporations.push({date: date, id: attacker.corporation.id, data: attacker.corporation});
        [<span class="hljs-string">&apos;...&apos;</span>]
            }
        })
    }

    <span class="hljs-comment">// flush the cache into postgres</span>
    <span class="hljs-keyword">this</span>.cache = {
        alliances: [],
        corporations: [],
        characters: [],
        shipTypes: []
    }
}

<span class="hljs-built_in">module</span>.exports = Harvester;
</code></pre>
<h2 id="authentifizierung">Authentifizierung</h2>
<p>Die Public API <em>CREST</em><sup><a href="#fn_4" id="reffn_4">4</a></sup> ist eine REST API. Dies bedeutet, dass solange die jeweilgen Pfade um auf die API zuzugreifen, dynamisch erzeugt werden, Updates der API nicht unsere App beinflussen.
CREST ist deshalb sinnvoll zu benutzen, da es direkt mit dem Spieleserver kommuniziert und nicht mit der Backend-Datenbank des Entwicklers. Somit hat man einen klareren Zugang zum aktuellen Stand des Spieles. Des weiteren ist es f&#xFC;r hohen Traffic und starkes Caching ausgelegt, sodass sie schnell und zuverl&#xE4;ssig funktioniert.
Ein gro&#xDF;er Teil der Endpoints ist ohne Authentifizierung zu erreichen. Hierzu muss man lediglich den entsprechenden Endpoint aufrufen und kann ohne weiteres mit den JSON-Daten arbeiten.
Jedoch ben&#xF6;tigen wir f&#xFC;r den Zugriff auf die Verlustdaten eine Authentifizierung, um auf die userspezifischen Daten zugreifen zu k&#xF6;nnen.
Hierzu wird ein <em>SSO-access-token</em> ben&#xF6;tigt, welches man erh&#xE4;lt, wenn man seine App bei dem Entwickler CCP registriert. Jede Anfrage auf einen Endpoint, welcher Authentifizierung ben&#xF6;tigt muss diesen Token beinhalten.</p>
<p>Ebenso wird ein Authentifizierungs-Token f&#xFC;r den gew&#xFC;nschten User ben&#xF6;tigt, der seine Lossmail importiert. Der User wird beim Aufruf automatisch auf die offizielle Authentifizierungsseite weitergeleitet. Dort muss er seine Einlogg-Daten verwenden und best&#xE4;tigt, dass er der App tats&#xE4;chlich diese Daten zur Verf&#xFC;gen stellen m&#xF6;chte.
Der Server antwortet der App, dass der User sich erfolgreich authentifiziert hat und das ben&#xF6;tigte Token wird &#xFC;bermittelt. Mit diesem Token kann dann auf die Userdaten zugegriffen und gearbeitet werden.</p>
<p>Dies erreichen wir mit (in Ausz&#xFC;gen) folgendem Code:</p>
<pre><code class="lang-javascript">router.get(<span class="hljs-string">&apos;/crest&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) </span>{
    <span class="hljs-keyword">const</span> endpoint = <span class="hljs-string">&apos;https://login.eveonline.com/oauth/token&apos;</span>;
    <span class="hljs-keyword">const</span> params = {
    [<span class="hljs-string">&apos;...&apos;</span>]
    };
    <span class="hljs-keyword">const</span> auth = {
    [<span class="hljs-string">&apos;...&apos;</span>]
    };

    request.post(endpoint, {form: params, auth: auth}).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">body</span>) </span>{
      [<span class="hljs-string">&apos;...&apos;</span>]
        <span class="hljs-keyword">const</span> headers = {
            <span class="hljs-string">&apos;Authorizatio&apos;</span>: <span class="hljs-string">&apos;Bearer &apos;</span> + tokenData.access_token
        }
        <span class="hljs-keyword">return</span> request(endpoint, {headers: headers});
    }).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">body</span>) </span>{
        <span class="hljs-keyword">var</span> characterData = <span class="hljs-built_in">JSON</span>.parse(body);
        <span class="hljs-keyword">return</span> cm.upsert(characterData).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> cm.get(characterData.CharacterID);
        }).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">row</span>) </span>{
            res.send({
                token: token,
                data: row
            });
        })
    [<span class="hljs-string">&apos;...&apos;</span>]
    })
})

<span class="hljs-built_in">module</span>.exports = router;
</code></pre>
<p>Hier bei wird auf den gew&#xFC;nschten Endpoint mit bestimmten Aufrufargumenten eine Anfrage gestellt. Die API gibt ein JSON-Objekt zur&#xFC;ck, welches die Daten zu dem angefragten Charakter erh&#xE4;lt.</p>
<h2 id="continuous-integration">Continuous Integration</h2>
<p>Die gesamte Umsetzung des Projektes beruht auf &quot;kontinuerlicher Integration&quot;. Demnach sind die einzelnen Bereiche und Methoden von einander getrennt und werden jeweils an der Stelle eingebunden an der sie ben&#xF6;tigt werden.
Wichtige Grundelemnte beinhalten eine gemeinsame Codebasis, welche &#xFC;ber eine Versionsverwaltung l&#xE4;uft, eine h&#xE4;ufige Integratino, also ein regelm&#xE4;&#xDF;iges Integrrieren von Code in den Hauptbranch des Projektes und kurze Testzyklen, in denen kleine und pr&#xE4;gnante Tests abgehalten werden.
So ist man nicht abh&#xE4;nig von Meilensteinen, sondern kann INtegrations-Probleme laufend entdecken und beheben und hat jederzeit eine lauff&#xE4;hige Version des Programmes zu Demo- oder Testzwecken.<sup><a href="#fn_5" id="reffn_5">5</a></sup></p>
<p>[INSERT TEST HERE]</p>
<h2 id="heroku">Heroku</h2>
<p>Heroku ist eine Cload-basierte PaaS (Platform-as-a-Service) welches ausgezeichneten Service f&#xFC;r PostgreSQL und NodeJS bietet. Es passt einwandfrei zu unseren Vorraussetzungen und zu unserem <em>&quot;CI&quot;</em>-Modell, da es sich gut in einen git-Workflow integrieren l&#xE4;sst. Des weiteren kann man Applikationen sehr leicht dazu konfigurieren automatisch die neuste Version auf Heroku zur Verf&#xFC;gung zu stellen. Hier bei liegt auch die St&#xE4;rke in der Verbindung mit <em>&quot;CI&quot;</em>. </p>
<hr>
<p><sup><a href="#fn_4" id="reffn_4">4</a></sup> <a href="https://developers.eveonline.com/resource/resources" target="_blank">CREST-API Dokumentation https://developers.eveonline.com/resource/resources</a> (abgerufen am 14.05.2015 - 20:00)</p>
<p><sup><a href="#fn_5" id="reffn_5">5</a></sup> <a href="https://de.wikipedia.org/wiki/Kontinuierliche_Integration" target="_blank">Kontinuierliche Integration - Wikipedia - https://de.wikipedia.org/wiki/Kontinuierliche_Integration</a> (aufgerufen am 17.05.2016 - 22:25)</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../intro/introduction.html" class="navigation navigation-prev " aria-label="Previous page: Einleitung"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../analyse.html" class="navigation navigation-next " aria-label="Next page: Analyse"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"livereload":{}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
